<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Reactive programming for service orchestration on JVM</title>
  <meta name="description" content="Reactive programming for service orchestration on JVM">
  <meta name="author" content="Ozan Gunalp">
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <link rel="stylesheet" href="../bower_components/reveal.js/css/reveal.css">
  <link rel="stylesheet" href="../bower_components/reveal.js/lib/css/zenburn.css">
  <link rel="stylesheet" href="../css/lesfurets-theme.css" id="theme">
  <link rel="stylesheet" href="../css/git-octopus-theme.css" id="octopus-theme">
  <link rel="stylesheet" href="../css/code-jooq-theme.css" id="jooq-theme">
  <script>
      if (window.location.search.match(/print-pdf/gi)) {
          var link = document.createElement('link');
          link.rel = 'stylesheet';
          link.type = 'text/css';
          link.href = '../css/print/pdf.css';
          document.getElementsByTagName('head')[0].appendChild(link);
      }
  </script>
  <!--[if lt IE 9]>
  <script src="../bower_components/reveal.js/lib/js/html5shiv.js"></script><![endif]-->
</head>
<body>
<div id="footer" class="footer show">
  <a href="https://www.lesfurets.com" target="_blank">
    <img class="logo" src="../img/logo_lesfurets_885x128_no_back.png">
  </a>
  <a class="github" href="https://github.com/lesfurets" target="_blank">https://github.com/lesfurets</a>
  <a class="twitter" href="https://twitter.com/BeastieFurets" target="_blank">@BeastieFurets</a>
  <a class="github" href="https://github.com/ozangunalp" target="_blank">https://github.com/ozangunalp</a>
  <a style="margin-right: 10px;" class="twitter" href="https://twitter.com/ozangunalp" target="_blank">@ozangunalp</a>
  <!--<img style="width:50px;vertical-align:middle;padding-left:25px" src="../img/theodo-logo-medium.png">-->
  <span style="font-family:arial;font-weight:bold;font-size:25px;vertical-align:middle">BreizhJUG</span>
</div>
<div class="reveal">
  <div class="slides">
    <!-- SECTION - INTRO -->

    <section class="flushright" data-state="background-furets">
      <h1>Reactive programming</h1>
      <h2>for service orchestration<br>on JVM</h2>
      <h3>Ozan Gunalp</h3>
    </section>

    <section class="flushleft" data-state="background-furets">
      <h3 style="color:#f07d00">Ozan GUNALP</h3>
      <ul class="flushright nodisc">
        <li>
          <a style="color:white" href="https://twitter.com/ozangunalp">twitter.com/ozangunalp</a>
        </li>
        <li>
          <a style="color:white" href="https://github.com/ozangunalp">github.com/ozangunalp</a>
        </li>
      </ul>
      <h3 style="color:#f07d00">Contributors</h3>
      <ul class="flushleft small nodisc">
        <li>Gilles Di Guglielmo</li>
      </ul>
    </section>

    <!-- SECTION - CONTEXT -->

    <section class="center" data-background="#333">
      <h2>LesFurets.com</h2>
      <img style="width: 75%;background-color: white" src="../img/PPS_LesFurets_com.png">
      <!--<ul class="white nodisc">-->
        <!--<li>Insurance comparison</li>-->
        <!--<li>We call web-services of more than 25 insurers to have the best prices.</li>-->
      <!--</ul>-->
    </section>

    <section class="center" data-background="#333">
      <h2>LesFurets.com</h2>
      <ul class="white nodisc">
        <li>Apache Tomcat Blocking IO</li>
        <li>GWT RPC on Servlet</li>
      </ul>
      <p class="strong">We are far from being reactive.</p>
    </section>

    <section class="center" data-background="#333">
      <h2>Reactive Hype</h2>
      <img style="width: 75%;background-color: white" src="../img/reactive/hype_cycle.png">
      <p class="strong">Let's test this!</p>
    </section>

    <section class="center" data-background="#333">
      <h2>Service Orchestrator</h2>
      <img style="width: 85%;background-color: white" src="../img/scatter_gather.jpg">
    </section>

    <section class="center" data-background="#333">
      <h2>Service Orchestrator</h2>
      <img style="width: 75%;background-color: white" src="../img/sequence_diagram_one_client.jpg">
    </section>

    <section class="center" data-background="#333">
      <h2>Service Orchestrator</h2>
      <img style="width: 75%;background-color: white" src="../img/sequence_diagram_two_client.jpg">
    </section>

    <!-- Eight Fallacies of distributed computing -->
    <!--<li>1.	The network is reliable</li>-->
    <!--<li>2.	Latency is zero</li>-->
    <!--<li>3.	Bandwidth is infinite</li>-->
    <!--<li>4.	The network is secure</li>-->
    <!--<li>5.	Topology doesn't change</li>-->
    <!--<li>6.	There is one administrator</li>-->
    <!--<li>7.	Transport cost is zero</li>-->
    <!--<li>8.	The network is homogeneous</li>-->
    <section class="center" data-background="#333">
      <h2>Distributed Computing Fallacies</h2>
      <div class="flushleft">
        <ul class="white nodisc">
            <li>The network is <strong>NOT</strong> reliable</li>
            <li>Latency is <strong>NOT</strong> zero</li>
            <li>...</li>
            <li>There is <strong>NOT</strong> one administrator</li>
        </ul>
      </div>
    </section>

    <section class="center" data-background="#333">
      <h2>Service calls fail, a lot.</h2>
      <img style="width: 75%;background-color: white" src="../img/reactive/tessera.png">
    </section>

    <section class="center" data-background="#333">
      <h2>Time over</h2>
      <img style="width: 75%;background-color: white" src="../img/sequence_diagram_time_over.jpg">
    </section>

    <section class="center" data-background="#333">
      <h2>Being reactive, on Slack</h2>
      <img style="width: 75%;background-color: white" src="../img/reactive/Slack_-_LesFurets.png">
    </section>

    <section class="center" data-background="#333">
      <h2>Clean-er code ?</h2>
      <div class="code-wrapper smaller">
      <pre>
          <code class="code java" data-trim data-noescape>
    private Map doQuotation(ResultatTarifications resultat, Control control, List products) {
        //...
        final List runnables = new ArrayList<>();
        try {
            prepareRunnables(runnables, projet, resultat, products, control, ...);
            long timeOut = control.getConnectionTimeout();
            final long startTime = System.currentTimeMillis();
            for (OrchestratorRunnable runnable : runnables) {
                // .. mapping in, web service call, mapping out
                executeRunnable(timeOut, startTime, runnable);
            }
            waitAll(startTime, getModule(), runnables, timeOut);
            logTarificationTimer(runnables, startTime);
            postTraitements(resultat);
        } catch (Throwable t) {
            LOG.error("Error occurs during tarifications " + projet.getOffreUid(), t);
        } finally {
            checkResultat(resultat);
        }
        final Map contexts = new HashMap<>();
        for (TarificationRunnable runnable : runnables) {
            contexts.put(runnable.getProvider(), runnable.getContext());
        }
        return Collections.unmodifiableMap(contexts);
    }
          </code>
      </pre>
      </div>
    </section>

    <section class="center" data-background="#333">
      <h2>How do we scale?</h2>
      <img style="width: 75%;background-color: white" src="../img/sequence_diagram_thread_busy.jpg">
      <p class="strong">Thread pool size per endpoint : 2</p>
    </section>

    <section class="center" data-background="#333">
      <h2>Buzzy thread pool</h2>
      <div class="code-wrapper">
      <pre>
          <code class="code java" data-trim data-noescape>
if (executor.getActiveCount() >= POOL_SIZE) {
    throw new NoExecutorAvailable("ThreadPool buzy");
}
          </code>
      </pre>
      </div>
    </section>

    <section class="center" data-background="#333">
      <h2>Underlying problems</h2>
      <ul class="white nodisc">
        <li><span class="strong color-indigo300">Scalability</span> : + resources &rarr; + performance</li>
        <li><span class="strong color-indigo300">Resilience</span> : SLA management</li>
        <li><span class="strong color-indigo300">Maintainability</span> : Clean code</li>
      </ul>
    </section>

    <section class="center" data-background="#333">
      <h2>Asynchronous execution</h2>
      <ul class="nodisc">
        <li><span class="strong color-deeporange300">Scalability</span> : distribute tasks to multiple resources</li>
        <li><span class="strong color-deeporange300">Resilience</span> : isolation of errors</li>
      </ul>
    </section>

    <section class="center" data-background="#333">
      <h2>Mastering concurrency is difficult.</h2>
      <div class="flushleft" style="position: absolute">
      <ul class="nodisc small">
        <li>Thread pool management</li>
        <li>Access to shared state (deadlocks, race conditions)</li>
        <li>Error handling (i.e. timeouts)</li>
        <li>Composing / coordinating async tasks</li>
        <li>Throughput management</li>
        <li>...</li>
      </ul>
      </div>
      <div class="flushright" style="position: relative">
        <img style="width: 25%;background-color: white" src="../img/java_concurrency.jpg">
      </div>
    </section>

    <section class="center" data-background="#333">
      <h2>Asynchronous abstractions</h2>
      <ul class="white nodisc">
        <li>ExecutorService and locks</li>
        <li>Message queues with buffering</li>
      </ul>
    </section>

    <section class="center" data-background="#333">
      <h2>Synchronous API</h2>
      <div class="code-wrapper">
      <pre>
          <code class="code java" data-trim data-noescape>
            public String httpBlockingGet(String url);
          </code>
      </pre>
      </div>
    </section>

    <section class="center" data-background="#333">
      <h2>ExecutorService</h2>
      <div class="code-wrapper">
      <pre>
          <code class="code java" data-trim data-noescape>
                Future&lt;String&gt; http = ExecutorService executor = Executors.newCachedThreadPool();
    executor.submit(() -> {
      try {
        return httpBlockingGet("http://www.lesfurets.com");
      } catch (Exception e) {
        e.printStackTrace();
        return "Error :"+e.getMessage();
      }
    });
    // blocking get
    String content = http.get();
          </code>
      </pre>
      </div>
    </section>

    <section class="center" data-background="#333">
      <h2>Message Queues</h2>
      <img style="width: 75%;background-color: white" src="../img/reactive/jobqueue1.png">
      <p class="strong">Handle changes on throughput with buffering</p>
      <p class="strong color-indigo300">What if workers can't keep up with events?<br>
        <span class="color-deeporange300">java.lang.OutOfMemoryError</span>
      </p>
    </section>

    <section class="center small" data-background="#333" data-markdown>
      <div style="align-content: center;">
        <script type="text/template">
          ||ExecutorService |Message Queues|
          |:--|--|--|--|--|
          |Thread management|+|+|
          |Shared state|-|-|
          |Composability|-|~|
          |Error handling|-|-|
          |Throughput management|-|~|
        </script>
      </div>
    </section>

    <section class="center" data-background="#333">
      <h2>Reactive Programming</h2>
      <p>React to <span class="strong color-deeporange300">asynchronous</span>
        data / events<br>
        <span class="strong color-indigo300">+</span><br>
        [<span class="strong color-deeporange300">declarative</span> flow of data transformations]
      </p>
      <p><span class="strong color-deeporange300">&ne;</span><br>
        <span class="strong">Reactive Systems</span><br>
        Architectural design pattern for distributed systems
      </p>
    </section>

    <section class="center" data-background="#333">
      <h2>Reactive abstractions</h2>
      <ul class="white nodisc">
        <li>Event loops with callbacks</li>
        <li>Promise/Future/CompletableFuture</li>
        <li>Reactive Streams</li>
      </ul>
    </section>

    <section class="center" data-background="#333">
      <h2>Event Loops</h2>
      <img style="width: 75%;background-color: white" src="../img/reactive/ev-server.svg">
      <p class="strong">Mono thread + NIO</p>
    </section>

    <section class="center" data-background="#333">
      <h2>Asynchronous Callback</h2>
      <div class="code-wrapper">
      <pre>
          <code class="code java" data-trim data-noescape>
            public void httpAsyncGet(String url, Handler&lt;String&gt;);
          </code>
      </pre>
      </div>
      <div class="code-wrapper">
      <pre>
          <code class="code java" data-trim data-noescape>
            httpAsyncGet("http://www.lesfurets.com", ar -> {
              if (ar.isSuccess()) {
                String content = ar.result();
                // do something
              } else {
                Throwable e = ar.error();
                // handle error
              }
            });
          </code>
      </pre>
      </div>
      <p class="strong color-deeporange300">Death by callback</p>
    </section>

    <section class="center" data-background="#333">
      <h2>CompletableFuture</h2>
        <!--<li>Represents the result of an action that may, or may not, have occurred yet.</li>-->
      <div class="code-wrapper">
      <pre>
          <code class="code java" data-trim data-noescape>
          CompletableFuture.supplyAsync(() -> {
      try {
        return httpBlockingGet("http://www.lesfurets.com");
      } catch (Exception e) {
        return "Error :"+e.getMessage();
      }
    }, executor)
        .thenApply(c -> searchTitle(c))
        .thenAccept(s -> {
          // use title
        });
          </code>
      </pre>
      </div>
      <p class="strong color-deeporange300">Error handling</p>
    </section>

    <section class="small" data-background="#333" data-markdown>
      <div class="flushleft">
        <script type="text/template">
          ||ExecutorService |Message Queues|Event Loops|CompletableFuture|
          |:--|--|--|--|--|
          |Thread management|+|+|~|+|
          |Shared state|-|-|~|+|
          |Composability|-|~|-|+|
          |Error handling|-|-|~|-|
          |Throughput management|-|~|-|-|
        </script>
      </div>
    </section>



    <section class="center" data-background="#333">
      <h2>
        <span class="color-indigo300">Reactive</span>
        <span class="color-deeporange300">Streams</span>
      </h2>
    </section>

    <section class="center" data-background="#333">
      <h2>Streams != Collections</h2>
      <p>
        <span class="strong">Collection</span><br>
        <span class="color-indigo300 strong">Definition of data</span> : Iterable group of items,
        <br>definite size
      </p>
      <p>
        <span class="strong">Stream</span><br>
        <span class="color-indigo300 strong">Definition of work</span> : Operations on group of items,
        <br>unbounded size
      </p>
    </section>

    <section class="center" data-background="#333">
      <h2>Streams Java 8</h2>
      <div class="code-wrapper">
      <pre>
          <code class="code java" data-trim data-noescape>
            List&lt;QuoteResult&gt; resultList = LongStream.range(0, 11)
            .boxed()
            .map(l -> new QuoteRequest(l))
            .filter(l -> !fromRobot(l))
            .map(q -> q.toAnonymousRequest())
            .peek(System.out::println)
            .collect(Collectors.toList());
          </code>
      </pre>
      </div>
      <p class="strong">Functional programming &rarr; <br>
          immutability &rarr;<br>
        <span class="color-indigo300">no more shared state</span>
      </p>
    </section>

    <section class="center" data-background="#333">
      <h2>Reactive Streams</h2>
      <p>
        <span class="strong color-deeporange300">asynchronous</span> events<br>
        <span class="strong color-indigo300">+</span><br>
        <span class="strong color-deeporange300">declarative</span> functions<br>
        <span class="strong color-indigo300">+</span><br>
        non-blocking <span class="strong color-deeporange300">back pressure</span>
      </p>
    </section>

    <section class="center" data-background="#333">
      <h2>Back pressure ?</h2>
      <p class="strong">Remember message queues?</p>
      <!--Back pressure describes the build-up of data, when the incoming task rate is higher than the system’s -->
      <!--ability to process them – resulting in a buffer of unhandled data.-->
      <img style="width: 50%;background-color: white" src="../img/reactive/reactive-streams.001.png">
    </section>

    <section class="center" data-background="#333">
      <h2>Reactive Streams</h2>
      <img style="width: 85%;background-color: white" src="../img/reactive/reactive-streams.002.png">
      <p class="strong">Pull demand, Push data</p>
    </section>

    <section class="center" data-background="#333">
      <h2>Reactive Streams</h2>
      <div class="code-wrapper smaller">
      <pre>
          <code class="code java" data-trim data-noescape>
  public interface Publisher&lt;T&gt; {
    void subscribe(Subscriber&lt;? super &lt;T&gt; subscriber);
  }

  public interface Subscriber&lt;T&gt; {
    void onSubscribe(Subscription subscription);
    void onNext(T item);
    void onError(Throwable throwable);
    void onComplete();
  }

  public interface Subscription {
    void request(long n);
    void cancel();
  }
          </code>
      </pre>
      </div>
      <p class="strong">Included in Java 9<br>
        <code>java.util.concurrent.Flow</code>
      </p>
    </section>

    <section class="center" data-background="#333">
      <h2>Reactive Streams</h2>
      <ul class="nodisc strong">
        <li>RxJava2</li>
        <li>Spring Reactor</li>
        <li>Vert.x</li>
        <li>Akka Streams</li>
        <li>...</li>
      </ul>
    </section>

    <section class="center" data-background="#333">
      <h2>RxJava</h2>
      <p class="strong">
        Observables + Operators + Scheduling
      </p>
    </section>

    <section class="center" data-background="#333">
      <h2>Observables</h2>
      <div class="code-wrapper">
      <pre>
          <code class="code java" data-trim data-noescape>
    Observable.create(observer -> {
      try {
        observer.onNext(provider.getQuote());
        observer.onComplete();
      } catch (Exception e) {
        observer.onError(e);
      }
    });
          </code>
      </pre>
      </div>
      <div class="code-wrapper">
      <pre>
          <code class="code java" data-trim data-noescape>
            Observable.defer(() -> Observable.just(provider.getQuote());
          </code>
      </pre>
      </div>
      <div class="code-wrapper">
      <pre>
          <code class="code java" data-trim data-noescape>
            Observable.just(1,2,3,4);
          </code>
      </pre>
      </div>
    </section>

    <section class="center" data-background="#333">
      <h2>Operators</h2>
      <div class="code-wrapper">
      <pre>
          <code class="code java" data-trim data-noescape>
            Observable.fromIterable(providers)
              .map(p -> p.getQuote())
              .filter(q -> !q.hasError())
              .subscribe(System.out::println);
          </code>
      </pre>
      </div>
    </section>

    <section class="center" data-background="#333">
      <h2>Scheduling</h2>
      <div class="code-wrapper">
      <pre>
          <code class="code java" data-trim data-noescape>
            Observable.fromIterable(providers)
              .subscribeOn(Schedulers.io())
              .map(p -> p.getQuote())
              .filter(q -> !q.hasError())
              .observeOn(Schedulers.from(executorService))
              .subscribe(System.out::println);
          </code>
      </pre>
      </div>
      <p><code>subscribeOn</code>: on which thread events are <code>created</code>.</p>
      <p><code>observeOn</code>: on which thread events are observed.</p>
    </section>

    <section class="small" data-background="#333" data-markdown>
      <div class="flushleft">
        <script type="text/template">
          ||ExecutorService |Message Queues|Event Loops|CompletableFuture|RxJava2|
          |:--|--|--|--|--|
          |Thread management|+|+|~|+|+|
          |Shared state|-|-|~|+|+|
          |Composability|-|~|-|+|+|
          |Error handling|-|-|~|-|+|
          |Throughput management|-|~|-|-|+|
        </script>
      </div>
    </section>

    <section class="center" data-background="#333">
      <h2>Orchestrator</h2>
      <div class="code-wrapper smaller">
      <pre>
          <code class="code java" data-trim data-noescape>
    private Map doQuotation(ResultatTarifications resultat, Control control, List products) {
        //...
        final List runnables = new ArrayList<>();
        try {
            prepareRunnables(runnables, projet, resultat, products, control, ...);
            long timeOut = control.getConnectionTimeout();
            final long startTime = System.currentTimeMillis();
            for (OrchestratorRunnable runnable : runnables) {
                // .. mapping in, web service call, mapping out
                executeRunnable(timeOut, startTime, runnable);
            }
            waitAll(startTime, getModule(), runnables, timeOut);
            logTarificationTimer(runnables, startTime);
            postTraitements(resultat);
        } catch (Throwable t) {
            LOG.error("Error occurs during tarifications " + projet.getOffreUid(), t);
        } finally {
            checkResultat(resultat);
        }
        final Map contexts = new HashMap<>();
        for (TarificationRunnable runnable : runnables) {
            contexts.put(runnable.getProvider(), runnable.getContext());
        }
        return Collections.unmodifiableMap(contexts);
    }
          </code>
      </pre>
      </div>
    </section>

    <section class="center" data-background="#333">
      <h2>Orchestrator parallel stream</h2>

      <div class="code-wrapper smaller">
      <pre>
          <code class="code java" data-trim data-noescape>
ForkJoinPool forkJoinPool = new ForkJoinPool(10);

ForkJoinTask&lt;List&lt;QuoteResult&gt;&gt; submit = forkJoinPool.submit(() ->
    LongStream.range(0, 11).parallel()
        .boxed()
        .map(QuoteRequest::new)
        .flatMap(q -> providers.stream().parallel()
                // map in
                .map(p -> p.doReceiveQuote(q))
                // map out
        )
        .collect(Collectors.toList())
);

List&lt;QuoteResult&gt; results = submit.get();
          </code>
      </pre>
      </div>
<!--      <div class="code-wrapper smaller">
      <pre>
          <code class="code java" data-trim data-noescape>
            List&lt;QuoteResult&gt; results = submit.get();

            ForkJoinTask&lt;List&lt;QuoteResult&gt;&gt; submit = forkJoinPool
            .submit(() -> LongStream.range(0, 11).parallel()
            .boxed()
            .map(l -> new QuoteRequest(l, 0.0))
            .flatMap(q -> providers.stream()
                .map(p -> new QuoteContext(p, q))
            )
            .map(q -> q.setQ(q.getP().mapRequest(q.getQ())))
            .map(q -> q.setResult(q.getP().doReceiveQuote(q.getQ())))
            .map(q -> q.setResult(q.getP().mapResult(q.getResult())))
            .map(QuoteContext::getResult)
            .collect(Collectors.toList()));
        List&lt;QuoteResult&gt; results = submit.get();
          </code>
      </pre>
      </div>-->

    </section>

    <section class="center" data-background="#333">
      <h2>Orchestrator CompletableFuture</h2>
      <div class="code-wrapper smaller">
      <pre>
          <code class="code java" data-trim data-noescape>
private CompletableFuture&lt;QuoteResult&gt; quoteFromProvider(QuoteRequest q, Provider provider) {
  return CompletableFuture.supplyAsync(() ->
          provider.doReceiveQuote(q),
      executorService)
      .thenApply(provider::mapResult)
      .completeOnTimeout(new QuoteResult(new TimeoutException("Timeout")),
          getTimeout(), TimeUnit.MILLISECONDS);
}
          </code>
      </pre>
      </div>
    </section>

    <section class="center" data-background="#333">
      <h2>Orchestrator CompletableFuture</h2>
      <div class="code-wrapper smaller">
      <pre>
          <code class="code java" data-trim data-noescape>
List&lt;CompletableFuture&lt;QuoteResult&gt;&gt; futures = LongStream.range(0, 11).sequential()
    .boxed()
    .map(QuoteRequest::new)
    .flatMap(q -> providers.stream()
        .map(provider -> quoteFromProvider(q, provider))
    ).collect(Collectors.toList());
          </code>
      </pre>
      </div>
      <div class="code-wrapper smaller">
      <pre>
          <code class="code java" data-trim data-noescape>
CompletableFuture&lt;List&lt;QuoteResult&gt;&gt; resultList =
    CompletableFuture.allOf(futures.toArray(new CompletableFuture[0]))
        .thenApply(v -> futures.stream()
            .map(CompletableFuture::join)
            .collect(toList()));

List&lt;QuoteResult&gt; rl = resultList.get();
          </code>
      </pre>
      </div>
    </section>

    <section class="center" data-background="#333">
      <h2>Orchestrator RxJava Observable</h2>
      <div class="code-wrapper smaller">
      <pre>
          <code class="code java" data-trim data-noescape>
private Observable&lt;QuoteResult&gt; quoteFromProvider(QuoteRequest q, Provider p) {
  return Observable.just(q)
          .map(p::mapRequest)
          .map(p::doReceiveQuote)
          .map(p::mapResult)
          .timeout(getTimeout(), TimeUnit.MILLISECONDS,
              Observable.just(new QuoteResult(new TimeoutException("Timeout"))))
      .subscribeOn(Schedulers.from(executorService));
}
          </code>
      </pre>
      </div>
    </section>

    <section class="center" data-background="#333">
      <h2>Orchestrator RxJava Observable</h2>
      <div class="code-wrapper smaller">
      <pre>
          <code class="code java" data-trim data-noescape>
private Observable&lt;List&lt;QuoteResult&gt;&gt; quoteForAllProviders(QuoteRequest q) {
  return Observable.fromIterable(providers)
      .flatMap(p -> Observable.just(q)
          .map(p::mapRequest)
          .map(p::doReceiveQuote)
          .map(p::mapResult)
          .timeout(getTimeout(), TimeUnit.MILLISECONDS,
              Observable.just(new QuoteResult(new TimeoutException("Timeout"))))
          .subscribeOn(Schedulers.from(executorService)))
      .toList()
      .toObservable();
}
          </code>
      </pre>
      </div>
      <div class="code-wrapper smaller">
      <pre>
          <code class="code java" data-trim data-noescape>
List&lt;QuoteResult&gt; quotes = quoteForAllProviders(new QuoteRequest()).blockingSingle();
          </code>
      </pre>
      </div>
    </section>

    <section class="center" data-background="#333">
      <h2>Orchestrator RxJava2 Flowable</h2>
      <div class="code-wrapper smaller">
      <pre>
          <code class="code java" data-trim data-noescape>
private Flowable&lt;List&lt;QuoteResult&gt;&gt; quoteForAllProviders(QuoteRequest q) {
  return Flowable.fromIterable(providers)
      .flatMap(p -> Flowable.just(q)
          .onBackpressureBuffer(1, () -> warn("Buffer Overflow"),
              BackpressureOverflowStrategy.DROP_OLDEST)
          .observeOn(Schedulers.from(executorService))
          .map(p::mapRequest)
          .map(p::doReceiveQuote)
          .map(p::mapResult)
          .timeout(getTimeout(), TimeUnit.MILLISECONDS,
              Flowable.just(new QuoteResult(new TimeoutException("Timeout"))))
          .subscribeOn(Schedulers.from(executorService)))
      .toList()
      .toFlowable();
}
          </code>
      </pre>
      </div>
    </section>

    <section class="center" data-background="#333">
      <h2>Orchestrator RxJava2 Flowable</h2>
      <div class="code-wrapper smaller">
      <pre>
          <code class="code java" data-trim data-noescape>
final AtomicBoolean running = new AtomicBoolean(true);
List&lt;QuoteResult&gt; results = new ArrayList<>();
PublishProcessor&lt;Long&gt; processor = PublishProcessor.create();

Disposable subscribe = processor
    .map(QuoteRequest::new)
    .onBackpressureBuffer(100, () -> warn("Buffer Overflow "),
        BackpressureOverflowStrategy.DROP_OLDEST)
    .observeOn(Schedulers.from(executorService))
    .flatMap(this::getForAllProviders)
    .subscribe(results::addAll);

Flowable.interval(getRequestFrequency(), TimeUnit.MILLISECONDS, Schedulers.io())
    .takeWhile(t -> running.get())
    .subscribe(processor);

Thread.sleep(getWaitingTime());
running.set(false);
subscribe.dispose();
          </code>
      </pre>
      </div>
    </section>

    <section class="center" data-background="#333">
      <h2>How to manage thread pools?</h2>
      <p class="strong">
        <span>Global</span><br>
        <span class="color-deeporange300">vs</span><br>
        <span>Per endpoint</span>
      </p>
    </section>

    <section class="center" data-background="#333">
      <h2>How to apply back pressure?</h2>
      <p>
        <span class="strong">Per endpoint</span><br>
        <span class="strong color-deeporange300">vs</span><br>
        <span class="strong">Not at all ?</span>
      </p>
    </section>

    <section class="center" data-background="#333">
      <h2>Best practices & Pitfalls RxJava</h2>
      <ul class="white nodisc">
        <li>Difference between subsribeOn and observeOn</li>
        <li>Back pressure configuration</li>
        <li>Debugging and handling errors</li>
        <li>Using with legacy code : accessing mutable state</li>
        <li>Creation of Observables</li>
      </ul>
    </section>

    <section class="center" data-background="#333">
      <h2><span class="color-deeporange300">Completable</span>Future</h2>
      <ul class="white nodisc">
        <li>Managing SLAs : implementing circuit breaker</li>
        <li>Compare impact on request handling behavior</li>
        <li>Benchmarking performance</li>
      </ul>
    </section>

    <section class="center" data-background="#333">
      <h2>Reactive Book</h2>
      <img style="width: 40%;background-color: white" src="../img/reactive/lrg.jpg">
    </section>

    <section class="center" data-state="background-furets">
      <h2>Open Source @ Lesfurets</h2>
      <a class="github" href="https://github.com/lesfurets" target="_blank">https://github.com/lesfurets</a>
    </section>

  </div>
</div>
<script src="../bower_components/reveal.js/lib/js/head.min.js"></script>
<script src="../bower_components/reveal.js/js/reveal.js"></script>
<script>
    // Full list of configuration options available here:
    // https://github.com/hakimel/reveal.js#configuration
    Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,
        embedded: true,

        // Hack my remote because it send 5 events
        keyboard: {
            // Tab : nop
            9: null,
            // Page down : previous slide
            33: function () {
                if (!window.animate) {
                    window.animate = true;
                    Reveal.left();
                    setTimeout(function () {
                        window.animate = false;
                    }, 1000);
                }
            },
            // Page up : next slide
            34: function () {
                if (!window.animate) {
                    window.animate = true;
                    Reveal.right();
                    setTimeout(function () {
                        window.animate = false;
                    }, 1000);
                }
            }
        },


        //theme: 'lesfurets', // available themes are in /css/theme
        transition: Reveal.getQueryHash().transition || 'linear', // default/cube/page/concave/zoom/linear/fade/none

        // Parallax scrolling
        // parallaxBackgroundImage: 'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg',
        // parallaxBackgroundSize: '2100px 900px',

        // Optional libraries used to extend on reveal.js
        dependencies: [
            {
                src: '../bower_components/reveal.js/lib/js/classList.js', condition: function () {
                return !document.body.classList;
            }
            },
            {
                src: '../bower_components/reveal.js/plugin/markdown/marked.js', condition: function () {
                return !!document.querySelector('[data-markdown]');
            }
            },
            {
                src: '../bower_components/reveal.js/plugin/markdown/markdown.js', condition: function () {
                return !!document.querySelector('[data-markdown]');
            }
            },
            {
                src: '../bower_components/reveal.js/plugin/highlight/highlight.js', async: true, callback: function () {
                hljs.initHighlightingOnLoad();
            }
            },
            {
                src: '../bower_components/reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function () {
                return !!document.body.classList;
            }
            },
            {
                src: '../bower_components/reveal.js/plugin/notes/notes.js', async: true, condition: function () {
                return !!document.body.classList;
            }
            }
        ]
    });
</script>
<script src="../js/lesfurets-theme.js" async></script>
</body>
</html>
